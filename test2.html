<!DOCTYPE html>
<html>
<head>
	<title>Test real-time updates</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
	<meta name="viewport" content="width=570"/>
	<style type="text/css">
		@import "/library/dojo/1.8.0/dojo/resources/dojo.css";
		@import "/library/dgrid/css/dgrid.css";
		@import "/library/dgrid/css/skins/claro.css";
	</style>
	<script type="text/javascript">
	var dojoConfig = {
		async: true,
		//baseUrl: 'http://ajax.googleapis.com/ajax/libs/dojo/1.7.1/dojo/',
		baseUrl: '/library/dojo/1.8.0/dojo/',
		packages: [
			{name: 'dgrid', location: '/library/dgrid'},
			{name: 'xstyle', location: '/library/xstyle'},
			{name: 'put-selector', location: '/library/put-selector'}
		]
	};

	</script>
	<script type="text/javascript" src="library/dojo/1.8.0/dojo/dojo.js"></script>
	<script type="text/javascript">
	require(["dgrid/List", "dgrid/OnDemandGrid", "dgrid/Selection", "dgrid/editor", "dgrid/Keyboard",
		"dgrid/tree",

		'dgrid/extensions/DnD',
		'dgrid/extensions/ColumnResizer',
		'dgrid/extensions/ColumnHider',

		"dojo/_base/declare", "dojo/store/JsonRest", "dojo/store/Observable", "dojo/store/Cache",
		"dojo/store/Memory", "dojo/_base/Deferred", 'dojo/on', "dojo/domReady!"
	],
		function(List, Grid, Selection, editor, Keyboard, tree, DnD, ColumnResizer, ColumnHider, declare, JsonRest, Observable, Cache, Memory, Deferred, on) {
			var stockStore = new Observable(new JsonRest({
				target: "./stocks.json"
			}));

			window.grid = new (declare([Grid, Selection, Keyboard, DnD]))({
				store: stockStore,
				query: {},
				columns: {
					id: "Symbol",
					name: "Name",
					price: {formatter: function(value) {
						return "$" + value.toFixed(2);
					}, label: "Price"}
				}
			}, "grid");
			stockStore.query({})/*.then(function(results) {
				function nextUpdate() {
					var stock = results[Math.floor(Math.random() * results.length)];
					stock.price += Math.random();
					stockStore.notify(stock, stock.id);
					setTimeout(nextUpdate, Math.random() * 1000);
				}

				nextUpdate();
			});*/


			on(document, '.claro:mousedown', function(evt) {
				// for the time being we have to rely on the order of the selectors to prevent execute this twice in
				// case we are on the grid/tree. Note: grid cancels bubbling or parent container for left mousedown only
	//			evt.stopImmediatePropagation();
				console.log(this, evt.type) //), evt.parentType);
			});
		});

	</script>
</head>
<body class="claro">
<h2>A grid with real-time updates</h2>

<div id="grid"></div>
<a href="https://github.com/SitePen/dgrid">dgrid</a>
</body>
</html>